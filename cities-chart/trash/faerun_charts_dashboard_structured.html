<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Faerûn Economic Dashboard</title><style>
    body {
        background-color: #1b1a17;
        color: #e4d4b3;
        font-family: 'Garamond', 'Times New Roman', serif;
        margin: 0;
        padding: 2em;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1em;
    }
    th, td {
        border: 1px solid #555;
        padding: 0.5em;
        text-align: left;
    }
    th {
        background-color: #322f28;
        cursor: pointer;
    }
    tr:nth-child(even) {
        background-color: #2a2823;
    }
    tr:hover {
        background-color: #3a362e;
    }
    h1, p {
        color: #f8e8c8;
    }

section > canvas {
    max-height: 40vh;
    max-width: 30vw;
}
tr.selected-row {
    background-color: rgba(180, 120, 50, 0.4) !important;
}
</style></head><body><header>Faerûn Economic Forum</header><main style="padding: 1em; font-family: sans-serif;"><section id="chartConfig" style="display: flex; flex-direction: row; flex-wrap: wrap; gap: 2em; padding: 1em;">
<label>Line Chart: Top/Bottom X <input id="lineX" max="50" min="1" type="number" value="10"/></label>
<label>Radar Buffer Limit <input id="radarCapInput" max="10" min="1" type="number" value="4"/></label>
<label>Correlation X <select id="corrX"></select></label>
<label>Correlation Y <select id="corrY"></select></label>
</section><section id="chartZone" style="display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 1em; margin-bottom: 3em;">
<canvas id="barChart" style="flex: 1 0 30vw;"></canvas>
<canvas id="radarChart" style="flex: 1 0 30vw;"></canvas>
<canvas id="scatterChart" style="flex: 1 0 30vw;"></canvas>
<canvas id="lineChart" style="flex: 1 0 30vw;"></canvas></section></main><script>
/** Faerûn Economic Dashboard Data */
const faerunCityData = [{"c":"Airspur","pop":28000,"ships":9,"wagons":31,"bank":11600000,"export":80,"mage":28,"mil":30,"threat":26,"hub":68,"lit":51,"why":"Chessentan port and military enclave on the Inner Sea.","who":"War colleges, naval families, and temple-loyal merchants."},{"c":"Almorel","pop":17000,"ships":0,"wagons":26,"bank":8200000,"export":74,"mage":12,"mil":20,"threat":24,"hub":48,"lit":42,"why":"Lake of Steam trade caravan mid-point with farming wealth.","who":"Caravanserai holders and Lake of Steam investors."},{"c":"Arabel","pop":28000,"ships":0,"wagons":47,"bank":11600000,"export":80,"mage":12,"mil":38,"threat":30,"hub":68,"lit":60,"why":"Military logistics hub with mounted units, horses, and arms exports.","who":"Cormyte military and caravan masters backed by the Crown."},{"c":"Arrabar","pop":22000,"ships":5,"wagons":27,"bank":9800000,"export":77,"mage":12,"mil":24,"threat":22,"hub":61,"lit":43,"why":"Chondathan naval city with fishing and lacquer goods.","who":"Chondathan war-chiefs and river-taxed merchant routes."},{"c":"Athkatla","pop":118804,"ships":35,"wagons":130,"bank":39000000,"export":97,"mage":28,"mil":34,"threat":28,"hub":94,"lit":52,"why":"Merchant lords dominate trade flows from Amn’s mines, farms, and ports.","who":"Council of Six merchant lords and the Coin Lords’ cartel."},{"c":"Baldur’s Gate","pop":42000,"ships":16,"wagons":69,"bank":17400000,"export":90,"mage":12,"mil":36,"threat":28,"hub":85,"lit":54,"why":"Strategic coastal stopover between Waterdeep and Amn; exports grain, ore, timber.","who":"The Parliament of Peers, the Flaming Fist mercenaries, and merchant lords."},{"c":"Berdusk","pop":27000,"ships":0,"wagons":45,"bank":11200000,"export":79,"mage":12,"mil":20,"threat":16,"hub":66,"lit":64,"why":"Exporting books, ale, and light enchantment to Elturel and beyond.","who":"Scribes, sages, and Temple of Deneir-linked guilds."},{"c":"Bezantur","pop":42000,"ships":17,"wagons":46,"bank":16700000,"export":89,"mage":40,"mil":42,"threat":48,"hub":84,"lit":48,"why":"Thayan port controlling Red Wizard exports, magical goods, and slave trade.","who":"Red Wizards of Thay and state-run magical trade syndicates."},{"c":"Calimport","pop":192787,"ships":55,"wagons":140,"bank":42000000,"export":96,"mage":28,"mil":36,"threat":34,"hub":96,"lit":45,"why":"Ancient mercantile capital of Calimshan; pearl, spice, and slave trades.","who":"Pashas of the Calimport Houses, druidic and genie pacts, and the slavers’ guild."},{"c":"Cathtyr","pop":43000,"ships":14,"wagons":48,"bank":17300000,"export":90,"mage":12,"mil":24,"threat":24,"hub":86,"lit":40,"why":"Eastern trade entrepôt with links to Durpar, Ulgarth, and the Golden Water.","who":"Satraps and bureaucrat-merchants under the Durpari Code of Honor."},{"c":"Cimbar","pop":34000,"ships":14,"wagons":37,"bank":14800000,"export":83,"mage":12,"mil":32,"threat":30,"hub":76,"lit":42,"why":"Capital of Chessenta; militarized economy and artifact black market.","who":"Chessentan warlords, mercenary unions, and temple-funded nobles."},{"c":"Citadel Adbar","pop":14000,"ships":0,"wagons":12,"bank":6600000,"export":72,"mage":12,"mil":50,"threat":28,"hub":40,"lit":42,"why":"Dwarven fortress with refined goods shipped south in winter.","who":"King Harbromm’s iron syndicate and dwarven caste lords."},{"c":"Citadel Felbarr","pop":6700,"ships":0,"wagons":6,"bank":3800000,"export":70,"mage":12,"mil":45,"threat":28,"hub":30,"lit":50,"why":"Northern dwarves minting export-ready steelwork.","who":"Dwarven warrior-kings and forge-lords."},{"c":"Crimmor","pop":18000,"ships":0,"wagons":30,"bank":8900000,"export":75,"mage":12,"mil":18,"threat":22,"hub":52,"lit":48,"why":"Caravan city with spice, textiles, and southern freight consolidation.","who":"Amnian wagon masters and desert-shipping families."},{"c":"Daerlun","pop":17200,"ships":1,"wagons":28,"bank":8600000,"export":75,"mage":12,"mil":20,"threat":18,"hub":55,"lit":50,"why":"Sembian border town ferrying goods upriver and downroad.","who":"Local councils and caravan charterers."},{"c":"Daggerford","pop":4100,"ships":1,"wagons":6,"bank":1600000,"export":69,"mage":12,"mil":20,"threat":20,"hub":24,"lit":48,"why":"Minor Waterdhavian satellite on cattle and grain route.","who":"Duke’s family and toll keepers."},{"c":"Darromar","pop":22000,"ships":0,"wagons":49,"bank":10100000,"export":77,"mage":12,"mil":34,"threat":16,"hub":60,"lit":46,"why":"Tethyr’s capital; growing fast post-restoration and collecting trade tax.","who":"Queen-Monarch and Tethyrian Crown allies rebuilding the realm."},{"c":"Delzimmer","pop":11348,"ships":0,"wagons":19,"bank":6000000,"export":71,"mage":12,"mil":18,"threat":30,"hub":38,"lit":34,"why":"Shaar frontier trade and monster-part commerce.","who":"Merchant-princes and guilds backed by adventurers’ wealth."},{"c":"Derlusk","pop":12600,"ships":4,"wagons":14,"bank":6300000,"export":72,"mage":12,"mil":20,"threat":20,"hub":40,"lit":42,"why":"Tethyr’s last port south with logging and saltfish.","who":"Border barons and southern guildholders."},{"c":"Elmwood","pop":2000,"ships":0,"wagons":3,"bank":800000,"export":68,"mage":12,"mil":12,"threat":24,"hub":18,"lit":34,"why":"Tree-cutting village surviving off barge runs.","who":"Logging camp owners and barge operators."},{"c":"Eltabbar","pop":34000,"ships":4,"wagons":37,"bank":14800000,"export":83,"mage":28,"mil":38,"threat":36,"hub":76,"lit":50,"why":"Thayan bureaucratic core with arcane export monopolies and war-profits.","who":"Thayan state officials, Red Wizard satraps, and bonded merchant houses."},{"c":"Elturel","pop":17644,"ships":0,"wagons":29,"bank":8700000,"export":75,"mage":12,"mil":38,"threat":14,"hub":54,"lit":68,"why":"Religious center with donations, fairs, and policing mercantile routes.","who":"Companions of Elturgard and church-sponsored guards."},{"c":"Esmeltaran","pop":39500,"ships":7,"wagons":44,"bank":15900000,"export":87,"mage":12,"mil":22,"threat":18,"hub":81,"lit":62,"why":"Amnian intellectual capital; perfumeries, books, and enchanted goods.","who":"Perfumer dynasties, minor wizard schools, and Amnian spice families."},{"c":"Espar","pop":8000,"ships":0,"wagons":8,"bank":3000000,"export":70,"mage":12,"mil":16,"threat":16,"hub":32,"lit":42,"why":"Border holdfast with Cormyrean guard outposts and livestock.","who":"Local lord and tax-farmers for Suzail."},{"c":"Evereska","pop":11300,"ships":0,"wagons":12,"bank":5800000,"export":71,"mage":28,"mil":32,"threat":20,"hub":36,"lit":92,"why":"Elven cultural export in magic items and rare herbs.","who":"High Elders of the Wealdath and spellweavers."},{"c":"Everlund","pop":23700},{"c":"Eversult","pop":12000,"ships":4,"wagons":10,"bank":5600000,"export":71,"mage":12,"mil":28,"threat":22,"hub":34,"lit":48,"why":"Coastal Chessenta city with religious import/export rites.","who":"Temple alliances and southern coastal nobles."},{"c":"Halarahh","pop":31000,"ships":11,"wagons":34,"bank":14000000,"export":82,"mage":40,"mil":28,"threat":18,"hub":72,"lit":82,"why":"Halruaa’s capital; floating cities, magical air trade, and arcane luxury.","who":"High Council of Halruaa, mage-lords, and skyship merchant dynasties."},{"c":"Heldapan","pop":22000,"ships":5,"wagons":24,"bank":9600000,"export":76,"mage":12,"mil":18,"threat":16,"hub":58,"lit":44,"why":"Durpar’s old route stop with modest temple tithe gold.","who":"Temple syndicates, grain guilds, and Durpari councilors."},{"c":"Highmoon","pop":4700,"ships":0,"wagons":6,"bank":2400000,"export":69,"mage":12,"mil":14,"threat":18,"hub":28,"lit":42,"why":"Small Sembian-supplied hill-town shipping orchard goods.","who":"Dales-folk clan lords and orchard owners."},{"c":"Hillsfar","pop":14000,"ships":3,"wagons":23,"bank":6900000,"export":73,"mage":12,"mil":30,"threat":32,"hub":45,"lit":38,"why":"Xenophobic, but exporting ores and tools via controlled docks.","who":"Autarch’s office and racist trade guilds."},{"c":"Hlondeth","pop":32000,"ships":5,"wagons":35,"bank":14600000,"export":82,"mage":12,"mil":28,"threat":32,"hub":74,"lit":44,"why":"Yuan-ti elite fund rich agriculture, alchemy, and inland trade.","who":"Yuan-ti elite, masked nobles, and serpent cults controlling trade."},{"c":"Hluthvar","pop":1500,"ships":0,"wagons":2,"bank":500000,"export":68,"mage":12,"mil":14,"threat":24,"hub":16,"lit":38,"why":"Amnian supply station with herd and weapon stops.","who":"Fort masters and road tithe collectors."},{"c":"Hulburg","pop":3200,"ships":2,"wagons":4,"bank":1500000,"export":69,"mage":12,"mil":12,"threat":24,"hub":24,"lit":34,"why":"Moonsea lake port with fish and cheap wood.","who":"Local baron and shipwrights."},{"c":"Innarlith","pop":12000,"ships":6,"wagons":13,"bank":4400000,"export":70,"mage":12,"mil":22,"threat":32,"hub":40,"lit":44,"why":"Lake of Steam city dealing in smoke powder and illicit gems.","who":"Lake Council and secretive gem traders."},{"c":"Iriaebor","pop":28600},{"c":"Leuthilspar","pop":11500,"ships":2,"wagons":11,"bank":5700000,"export":71,"mage":28,"mil":30,"threat":12,"hub":36,"lit":95,"why":"Evermeet’s modest open trade port for elite elven goods.","who":"Elven royalty and the Evermeet guard families."},{"c":"Longsaddle","pop":1400,"ships":0,"wagons":2,"bank":600000,"export":68,"mage":28,"mil":16,"threat":18,"hub":18,"lit":50,"why":"Mage-run hamlet with odd exports and enchanted steeds.","who":"Harples and spell-engineer kin groups."},{"c":"Loudwater","pop":7200,"ships":0,"wagons":8,"bank":3100000,"export":70,"mage":12,"mil":14,"threat":18,"hub":32,"lit":40,"why":"River junction town with fish and timber traffic.","who":"Mayor’s office and timber syndicates."},{"c":"Lyrabar","pop":19000,"ships":7,"wagons":21,"bank":7900000,"export":74,"mage":12,"mil":26,"threat":20,"hub":50,"lit":54,"why":"Impiltur’s state-sponsored trade house capital.","who":"Impilturian merchant dynasties and temple-favored houses."},{"c":"Marsember","pop":36000,"ships":12,"wagons":40,"bank":15300000,"export":84,"mage":12,"mil":32,"threat":24,"hub":78,"lit":64,"why":"Cormyrean river-port with naval contracts and deep harbor tariffs.","who":"Cormyrean Navy, dock guilds, and the War Wizards’ quartermasters."},{"c":"Melvaunt","pop":31100,"ships":10,"wagons":35,"bank":14100000,"export":82,"mage":12,"mil":34,"threat":30,"hub":74,"lit":46,"why":"Moonsea ironworks and arms trade with Zhent slaving outposts.","who":"Iron guilds, shipwrights, and Zhentarim-linked merchant families."},{"c":"Memnon","pop":35676,"ships":13,"wagons":40,"bank":15200000,"export":84,"mage":12,"mil":28,"threat":28,"hub":78,"lit":44,"why":"Desert crossing gateway and seat of genie-compacted power.","who":"Calishite desert lords, efreeti cults, and trade-route barons."},{"c":"Menzoberranzan","pop":24000,"ships":0,"wagons":0,"bank":8700000,"export":70,"mage":40,"mil":40,"threat":50,"hub":44,"lit":88,"why":"Drow trade nexus for weaponry, slaves, and poison.","who":"Ruling Houses (Baenre et al), drow trade priestesses, and Underdark slave rings."},{"c":"Messemprar","pop":28000,"ships":9,"wagons":31,"bank":11700000,"export":80,"mage":28,"mil":28,"threat":26,"hub":70,"lit":49,"why":"Mulhorandi heritage trade center with relic auctions and temple tithes.","who":"Priesthoods of Anhur and trade clergy of Waukeen."},{"c":"Mintarn","pop":3600,"ships":2,"wagons":4,"bank":1800000,"export":70,"mage":12,"mil":35,"threat":26,"hub":33,"lit":40,"why":"Mercenary-for-hire economy, plus naval escort coin.","who":"War captains and mercenary charterers."},{"c":"Mirabar","pop":23000,"ships":0,"wagons":25,"bank":10300000,"export":78,"mage":12,"mil":36,"threat":28,"hub":64,"lit":48,"why":"Dwarven coin-rich city exporting metals and gems through Luskan.","who":"Dwarven lords, stonecutters’ guild, and gem caravaneers."},{"c":"Mourktar","pop":14000,"ships":4,"wagons":16,"bank":6700000,"export":72,"mage":12,"mil":26,"threat":36,"hub":44,"lit":39,"why":"Threskel port under influence of undead-lord trade.","who":"Church of Bane and black-robed civic warlocks."},{"c":"Murann","pop":17000,"ships":7,"wagons":19,"bank":4800000,"export":71,"mage":12,"mil":24,"threat":28,"hub":42,"lit":46,"why":"Amnian fallback harbor for southern shipments.","who":"Militia-backed barons and guilds in exile."},{"c":"Myratma","pop":21000,"ships":5,"wagons":23,"bank":9300000,"export":76,"mage":12,"mil":16,"threat":18,"hub":56,"lit":41,"why":"South Tethyr agricultural shipping point.","who":"Trade captains and southern Amnian families."},{"c":"Nashkel","pop":3500,"ships":0,"wagons":4,"bank":1300000,"export":68,"mage":12,"mil":12,"threat":22,"hub":20,"lit":36,"why":"Mining outpost with iron and adventure coin influx.","who":"Mine bosses and Amnian overseers."},{"c":"Neverwinter","pop":23000,"ships":8,"wagons":25,"bank":10400000,"export":78,"mage":12,"mil":28,"threat":24,"hub":64,"lit":52,"why":"Mild climate allows year-round harbor use; lumber and crafts.","who":"Lord Dagult Neverember’s court, trade guilds, and wood barons."},{"c":"Ordulin","pop":28100,"ships":2,"wagons":31,"bank":11700000,"export":81,"mage":12,"mil":28,"threat":20,"hub":70,"lit":55,"why":"Sembia’s capital; all land trade taxed and rerouted through here.","who":"Sembian merchant-patricians and the hidden inner circle of Saerloon."},{"c":"Phlan","pop":8600,"ships":3,"wagons":10,"bank":2100000,"export":70,"mage":12,"mil":22,"threat":32,"hub":35,"lit":36,"why":"Moonsea restart city with archaeological relic trades.","who":"Council of Ten and relic dealers."},{"c":"Port Kir","pop":9000,"ships":4,"wagons":10,"bank":2300000,"export":71,"mage":12,"mil":16,"threat":22,"hub":38,"lit":38,"why":"Tethyr outport with long-haul cabotage trade.","who":"Tethyrian wardens and minor trade bosses."},{"c":"Procampur","pop":42000,"ships":17,"wagons":45,"bank":16600000,"export":88,"mage":12,"mil":30,"threat":20,"hub":83,"lit":60,"why":"Old-money Dragon Coast city with shipyards and stable trade links to Aglarond.","who":"Old nobility, shipwright dynasties, and Temple of Waukeen."},{"c":"Proskur","pop":12200,"ships":0,"wagons":20,"bank":5000000,"export":70,"mage":12,"mil":26,"threat":26,"hub":50,"lit":42,"why":"Caravan trail city taxing every crate bound west.","who":"Westbound caravan lords and guild coalition."},{"c":"Raven’s Bluff","pop":40000,"ships":16,"wagons":43,"bank":16100000,"export":88,"mage":12,"mil":31,"threat":20,"hub":82,"lit":58,"why":"Sane city in the Vast; growing naval and mercantile clout post-Adventurers Guild era.","who":"Civic guildmasters, reformed adventuring companies, and churches of Tyr and Waukeen."},{"c":"Reth","pop":13100,"ships":3,"wagons":15,"bank":6400000,"export":72,"mage":12,"mil":22,"threat":18,"hub":42,"lit":36,"why":"Coastal Chondath city with fishing, dried meats, and minor shipping.","who":"Local satraps and fishery league."},{"c":"Saelmur","pop":16300,"ships":3,"wagons":18,"bank":6900000,"export":72,"mage":12,"mil":20,"threat":22,"hub":40,"lit":52,"why":"Sembian port with leather, wool, and salt beef exports.","who":"Port lords and leather exporters."},{"c":"Saerloon","pop":54000,"ships":21,"wagons":59,"bank":18300000,"export":92,"mage":12,"mil":26,"threat":22,"hub":88,"lit":56,"why":"Sembian industrial city with strong textiles and glass exports.","who":"Arcane Brotherhood cells, glassblowers’ guilds, and Sembian textile barons."},{"c":"Sarshel","pop":17000,"ships":7,"wagons":19,"bank":7800000,"export":74,"mage":12,"mil":26,"threat":22,"hub":48,"lit":44,"why":"Impilturan seaport with outgoing fish and ores.","who":"Dockmasters’ guild, fishmongers, and Impiltur’s navy."},{"c":"Scornubel","pop":9000,"ships":0,"wagons":15,"bank":4300000,"export":70,"mage":12,"mil":18,"threat":28,"hub":46,"lit":39,"why":"Wagon-town crossroads where merchants exchange vault-weights and grain futures.","who":"Caravan unions and coin-barons on the trade road."},{"c":"Secomber","pop":1600,"ships":0,"wagons":2,"bank":550000,"export":68,"mage":12,"mil":12,"threat":20,"hub":16,"lit":36,"why":"Waystop town along the Delimbiyr trail.","who":"Waystop council and Delimbiyr shipping families."},{"c":"Selgaunt","pop":55000,"ships":18,"wagons":65,"bank":18700000,"export":93,"mage":12,"mil":28,"threat":20,"hub":91,"lit":58,"why":"Premier port of Sembia, seat of Sembian merchant houses, and art export hub.","who":"Saerloonian noble families and merchant consortiums like the Silver Consortium."},{"c":"Shadowdale","pop":1200,"ships":0,"wagons":2,"bank":400000,"export":68,"mage":28,"mil":28,"threat":28,"hub":22,"lit":55,"why":"Modest crops and pilgrimage traffic to the old temple.","who":"Elminster and local farmers’ syndicate."},{"c":"Sheirtalar","pop":38000,"ships":0,"wagons":42,"bank":15700000,"export":86,"mage":12,"mil":22,"threat":28,"hub":80,"lit":38,"why":"Lapaliiya’s queen city; loaded from jungle goods, spices, and harbor tolls.","who":"Lapaliiyaran merchant kings, jungle trade alliances, and spice guilds."},{"c":"Silverymoon","pop":37000,"ships":0,"wagons":41,"bank":15400000,"export":86,"mage":40,"mil":34,"threat":20,"hub":79,"lit":88,"why":"Magocracy with high-value magical exports and elite arcane education.","who":"Lady Alustriel’s Circle, Knights in Silver, and arcane academies."},{"c":"Skuld","pop":125000,"ships":20,"wagons":138,"bank":36000000,"export":94,"mage":28,"mil":38,"threat":26,"hub":92,"lit":50,"why":"Capital of Mulhorand; blessed by gods, command of Nile-like river trade and relic markets.","who":"Church of Horus-Re, priest-kings, and the pharaonic bureaucracy."},{"c":"Skullport","pop":2000,"ships":2,"wagons":0,"bank":1600000,"export":70,"mage":28,"mil":16,"threat":45,"hub":36,"lit":28,"why":"Underdark port selling contraband and rare arcana.","who":"Illithid and drow syndicates, Xanathar's guild, and slave dealers."},{"c":"Starmantle","pop":36000,"ships":22,"wagons":80,"bank":9500000,"export":66,"mage":28,"mil":30,"threat":26,"hub":72,"lit":54,"why":"Naval hub of the Vilhon Reach with deep harbor, coral trade, and high temple patronage.","who":"Merchant captains, sea guilds, and clergy of Selûne and Valkur"},{"c":"Suldolphor","pop":22000,"ships":7,"wagons":24,"bank":10000000,"export":78,"mage":12,"mil":18,"threat":18,"hub":62,"lit":44,"why":"Mid-Calimshan export port with grain and goat exports.","who":"Mid-Calimshan spice families and temple tax collectors."},{"c":"Sundabar","pop":12000,"ships":0,"wagons":10,"bank":5500000,"export":71,"mage":12,"mil":34,"threat":28,"hub":34,"lit":50,"why":"Fortress-city exporting tools and enchanted gear to the North.","who":"War Lord Helm Dwarf-friend and dwarven guilds."},{"c":"Suzail","pop":26000,"ships":10,"wagons":29,"bank":11000000,"export":81,"mage":12,"mil":45,"threat":18,"hub":72,"lit":70,"why":"Cormyr’s heart and harbor; taxes from nobles, navy, and grain export.","who":"Crown of Cormyr, Obarskyr family, and the Royal Guilds."},{"c":"Tashluta","pop":15000,"ships":6,"wagons":17,"bank":7100000,"export":73,"mage":12,"mil":22,"threat":26,"hub":47,"lit":46,"why":"Tashalar jungle trade nexus with local wine and pearl goods.","who":"Wine kings, jungle barons, and exotic goods handlers."},{"c":"Telflamm","pop":15000,"ships":6,"wagons":25,"bank":7300000,"export":73,"mage":12,"mil":24,"threat":34,"hub":46,"lit":52,"why":"Thesk’s smugglers’ den and local mercantile port.","who":"Merchant Princes and the Shadowmasters’ thieves’ guild."},{"c":"Thentia","pop":25900,"ships":5,"wagons":27,"bank":10800000,"export":81,"mage":12,"mil":24,"threat":22,"hub":71,"lit":58,"why":"Free port with bardic colleges and mercenary contracts on the Moonsea.","who":"Free-thinking bards, open councils, and independents with temple ties."},{"c":"Triboar","pop":2500,"ships":0,"wagons":4,"bank":1200000,"export":69,"mage":12,"mil":12,"threat":20,"hub":26,"lit":36,"why":"Horse-breeding economy with wagoner traditions.","who":"Horse-breeding houses and smiths."},{"c":"Tsurlagol","pop":13900,"ships":5,"wagons":16,"bank":6600000,"export":72,"mage":12,"mil":24,"threat":24,"hub":42,"lit":43,"why":"Trade relay between inland Impiltur and the sea.","who":"Impilturan governors and oceanic trade nobles."},{"c":"Urmlaspyr","pop":27000,"ships":10,"wagons":30,"bank":11000000,"export":79,"mage":12,"mil":25,"threat":20,"hub":65,"lit":56,"why":"Sembian factory city with road and sea linkages.","who":"Merchant families under Sembian law and port cartel guilds."},{"c":"Velen","pop":16200,"ships":12,"wagons":9,"bank":3900000,"export":59,"mage":6,"mil":31,"threat":18,"hub":47,"lit":35,"why":"Pearls, whale oil, and smoked fish flow outward; cedar spars and boat-keels flow inward. A harbor village turned lean-bellied port, thriving quietly under Selûne’s moon.","who":"Duke of Velen, longshore unions, fishscale tycoons, and temple harbormasters"},{"c":"Waterdeep","pop":132661,"ships":40,"wagons":220,"bank":45000000,"export":98,"mage":28,"mil":40,"threat":22,"hub":100,"lit":68,"why":"Center of continental trade, Deepwater Harbor, powerful guilds, and magical infrastructure.","who":"Masked Lords, Lord’s Alliance, and powerful guilds like the Master Mariners and Watchful Order of Magists."},{"c":"Westgate","pop":43000,"ships":16,"wagons":60,"bank":17600000,"export":92,"mage":12,"mil":30,"threat":42,"hub":88,"lit":42,"why":"Smuggler’s paradise; wealth from illicit trade, poisons, and rare imports.","who":"Night Masks, noble houses, and pirate-backed merchant cabals."},{"c":"Yartar","pop":5900,"ships":2,"wagons":10,"bank":2900000,"export":70,"mage":12,"mil":20,"threat":22,"hub":30,"lit":40,"why":"Bridge city extracting tolls and shipping logs.","who":"Waterbaron and the Hand of Yartar guild."},{"c":"Yhaunn","pop":35000,"ships":13,"wagons":39,"bank":15100000,"export":83,"mage":12,"mil":20,"threat":20,"hub":77,"lit":49,"why":"Sembian hub for dyes and high-quality wool exports.","who":"Sembian textile guilds, port masters, and regional barons."},{"c":"Zazesspur","pop":55000,"ships":22,"wagons":61,"bank":19000000,"export":91,"mage":12,"mil":28,"threat":26,"hub":89,"lit":46,"why":"Gateway to Calimshan and the south; shipbuilding, wines, and mercenaries.","who":"Tethyrian naval offices, wine lords, and merchant warbands."},{"c":"Zhentil Keep","pop":26000,"ships":6,"wagons":47,"bank":13800000,"export":81,"mage":12,"mil":48,"threat":45,"hub":73,"lit":36,"why":"War economy driven by trade control, tribute, and Zhentarim blackmail.","who":"Zhentarim mercantile-military oligarchy."}];

/** Dashboard Logic (Chart.js + UI) */
window.addEventListener('DOMContentLoaded', () => {


let lastSortedCol = 5;
let lastSortedDir = -1;
let radarBuffer = [];
let radarCap = 4;
const sortableKeys = ["pop","ships","wagons","bank","export","mage","mil","threat","hub","lit"];
const color = (i) => `hsl(${(i*47)%360},70%,60%)`;

let barChart, radarChart, scatterChart;

// Inject Chart.js
const script = document.createElement('script');
script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
script.onload = () => initCharts();
document.head.appendChild(script);

function initCharts() {
    const ctxBar = document.getElementById("barChart").getContext("2d");
    barChart = new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: [],
            datasets: [{ label: 'Top Metric', data: [], backgroundColor: '#a98342' }]
        },
        options: {
            responsive: true,
            onClick: (e, el) => {
                if (!el.length) return;
                const name = barChart.data.labels[el[0].index];
                const city = faerunCityData.find(c => c.c === name);
                const idx = radarBuffer.findIndex(c => c.c === name);
                if (idx !== -1) radarBuffer.splice(idx, 1);
                else {
                    if (radarBuffer.length >= radarCap) radarBuffer.shift();
                    radarBuffer.push(city);
                }
                updateRadar();
            },
            scales: {
                y: { ticks: { color: '#e4d4b3' }, grid: { color: '#333' } },
                x: { ticks: { color: '#e4d4b3' }, grid: { color: '#333' } }
            },
            plugins: { legend: { labels: { color: '#f8e8c8' } } }
        }
    });

    radarChart = new Chart(document.getElementById("radarChart").getContext("2d"), {
        type: 'radar',
        data: { labels: sortableKeys, datasets: [] },
        options: {
            responsive: true,
            scales: {
                r: {
                    pointLabels: { color: '#f8e8c8' },
                    grid: { color: '#555' },
                    angleLines: { color: '#444' },
                    ticks: { backdropColor: "#1b1a17", color: "#ccc" }
                }
            },
            plugins: { legend: { labels: { color: '#f8e8c8' } } }
        }
    });

    scatterChart = new Chart(document.getElementById("scatterChart").getContext("2d"), {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'City Correlation',
                data: [],
                backgroundColor: '#4da6ff'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { labels: { color: '#f8e8c8' } },
                tooltip: {
                    callbacks: {
                        label: ctx => `${ctx.raw.label}: (${ctx.raw.x}, ${ctx.raw.y})`
                    }
                }
            },
            scales: {
                x: {
                    title: { display: true, text: 'X', color: '#ccc' },
                    ticks: { color: '#e4d4b3' },
                    grid: { color: '#333' }
                },
                y: {
                    title: { display: true, text: 'Y', color: '#ccc' },
                    ticks: { color: '#e4d4b3' },
                    grid: { color: '#333' }
                }
            }
        }
    });

    updateBar();
    updateRadar();
    updateScatter("pop", "bank");
}

function getSortedCities() {
    return [...faerunCityData].sort((a, b) => {
        const va = a[sortableKeys[lastSortedCol - 2]];
        const vb = b[sortableKeys[lastSortedCol - 2]];
        return lastSortedDir * ((va || 0) - (vb || 0));
    }).slice(0, 10);
}

function updateBar() {
    const sorted = getSortedCities();
    const key = sortableKeys[lastSortedCol - 2];
    barChart.data.labels = sorted.map(c => c.c);
    barChart.data.datasets[0].data = sorted.map(c => c[key]);
    barChart.data.datasets[0].label = key;
    barChart.update();
}

function updateRadar() {
    radarChart.data.datasets = radarBuffer.map((c, i) => ({
        label: c.c,
        data: sortableKeys.map(k => c[k] || 0),
        fill: true,
        backgroundColor: color(i)+"33",
        borderColor: color(i),
        pointBackgroundColor: color(i)
    }));
    radarChart.update();
}

function updateScatter(xKey, yKey) {
    scatterChart.data.datasets[0].data = faerunCityData
        .filter(c => c[xKey] != null && c[yKey] != null)
        .map(c => ({ x: c[xKey], y: c[yKey], label: c.c }));
    scatterChart.options.scales.x.title.text = xKey;
    scatterChart.options.scales.y.title.text = yKey;
    scatterChart.update();
}

document.querySelectorAll("th").forEach((th, index) => {
    th.style.cursor = "pointer";
    th.addEventListener("click", () => {
        const isNumeric = ![1, 12, 13].includes(index);
        const dir = sortState[index] = -(sortState[index] || 1);
        lastSortedCol = index;
        lastSortedDir = dir;
        updateBar();
    });
});

document.querySelector("tbody").addEventListener("click", (e) => {
    const row = e.target.closest("tr");
    if (!row) return;
    const name = row.children[1].textContent;
    const city = faerunCityData.find(c => c.c === name);
    const idx = radarBuffer.findIndex(c => c.c === name);
    if (idx !== -1) radarBuffer.splice(idx, 1);
    else {
        if (radarBuffer.length >= radarCap) radarBuffer.shift();
        radarBuffer.push(city);
    }
    updateRadar();
});


let lineChart;

function initCharts() {
    // previously defined charts...
    const ctxLine = document.getElementById("lineChart").getContext("2d");
    lineChart = new Chart(ctxLine, {
        type: 'line',
        data: { labels: [], datasets: [{ label: 'Line Chart', data: [], borderColor: '#d48e30', fill: false }] },
        options: {
            responsive: true,
            scales: {
                y: { ticks: { color: '#e4d4b3' }, grid: { color: '#333' } },
                x: { ticks: { color: '#e4d4b3' }, grid: { color: '#333' } }
            },
            plugins: { legend: { labels: { color: '#f8e8c8' } } }
        }
    });

    sortableKeys.forEach(k => {
        let opt1 = document.createElement("option");
        opt1.value = k; opt1.textContent = k;
        let opt2 = opt1.cloneNode(true);
        document.getElementById("corrX").appendChild(opt1);
        document.getElementById("corrY").appendChild(opt2);
    });

    document.getElementById("corrX").addEventListener("change", () => {
        updateScatter(document.getElementById("corrX").value, document.getElementById("corrY").value);
    });
    document.getElementById("corrY").addEventListener("change", () => {
        updateScatter(document.getElementById("corrX").value, document.getElementById("corrY").value);
    });

    document.getElementById("radarCapInput").addEventListener("change", (e) => {
        radarCap = parseInt(e.target.value);
        while (radarBuffer.length > radarCap) radarBuffer.shift();
        updateRadar();
    });

    updateBar(); updateRadar(); updateScatter("pop", "bank"); updateLine();
}

function updateLine() {
    let key = sortableKeys[lastSortedCol - 2];
    let dir = lastSortedDir;
    let count = parseInt(document.getElementById("lineX").value) || 10;
    let sorted = [...faerunCityData].sort((a,b) => dir * ((a[key]||0)-(b[key]||0))).slice(0, count);
    lineChart.data.labels = sorted.map(c => c.c);
    lineChart.data.datasets[0].data = sorted.map(c => c[key]);
    lineChart.data.datasets[0].label = key;
    lineChart.update();
}

// updateBar should also call updateLine now:
const originalUpdateBar = updateBar;
updateBar = function() {
    originalUpdateBar();
    updateLine();
}

// update table click handler to reflect row selection
document.querySelector("tbody").addEventListener("click", (e) => {
    const row = e.target.closest("tr");
    if (!row) return;
    const name = row.children[1].textContent;
    const city = faerunCityData.find(c => c.c === name);
    const idx = radarBuffer.findIndex(c => c.c === name);
    row.classList.toggle("selected-row");
    if (idx !== -1) radarBuffer.splice(idx, 1);
    else {
        if (radarBuffer.length >= radarCap) {
            const oldName = radarBuffer.shift().c;
            document.querySelectorAll("tbody tr").forEach(tr => {
                if (tr.children[1].textContent === oldName) tr.classList.remove("selected-row");
            });
        }
        radarBuffer.push(city);
    }
    updateRadar();
};
});
</script></body></html>
